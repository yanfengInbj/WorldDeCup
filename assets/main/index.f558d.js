window.__require=function t(e,n,r){function s(i,o){if(!n[i]){if(!e[i]){var c=i.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!o&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+i+"'")}i=c}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){return s(e[i][1][t]||t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<r.length;i++)s(r[i]);return s}({colorbk:[function(t,e){"use strict";cc._RF.push(e,"0dc4f2YJidCXqdzAorm0AU3","colorbk"),cc.Class({extends:cc.Component,properties:{radius:4},start:function(){this.draw()},draw:function(){var t=this.node.getComponent(cc.Graphics),e=t.lineWidth,n=this.node.width-e,r=this.node.height-e;t.roundRect(-n/2,-r/2,n,r,this.radius),t.stroke(),t.fill()}}),cc._RF.pop()},{}],cupbar:[function(t,e){"use strict";cc._RF.push(e,"bf2defj10VM+5qAPhvHzJxJ","cupbar");var n=t("./utils");cc.Class({extends:cc.Component,name:"cupbar",properties:{prefab:{default:null,type:cc.Prefab},panel:{default:null,type:cc.Node}},start:function(){},setRules:function(t){var e=this;this.panel.removeAllChildren(!0);var r=this._calsx(t.length);t.forEach(function(t){var s=n.GameMgr.getRule(t),a=cc.instantiate(e.prefab);a&&(a.getChildByName("label").getComponent(cc.Label).string=s.title,a.x=r,a.parent=e.panel),r+=240})},_calsx:function(t){return 1===t?-80:2===t?-200:-320}}),cc._RF.pop()},{"./utils":"utils"}],main:[function(t,e){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","main");var n=t("./utils"),r=t("../datas/stagelist");function s(t,e){var n=window.URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=n,r.download=e,r.addEventListener("click",function(){r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(n)}function a(t,e){var n={"\u524d\u950b":"FW","\u540e\u536b":"BK","\u4e2d\u573a":"MF","\u5b88\u95e8\u5458":"GK"},r=JSON.parse(t),a="",i="";r.players.forEach(function(t,r){var s=r+1;a+='["'+t.avatar+'","'+s+'.png"],\n';var o=n[t.position]||"O",c=t.birthday,l=t.short_name||t.name;i+=s+",",i+=l+",",i+=e+",",i+=o+",",i+=c+",",i+=t.team_name+",",i+=t.name_en+",",i+=t.name+",",i+=t.team_name+",",i+=t.league+"\n"}),s(new Blob([i]),e+"_data.csv"),s(new Blob([a]),e+"_img.txt")}cc.Class({extends:cc.Component,properties:{jsonCountries:{default:null,type:cc.JsonAsset},jsonRoles:{default:null,type:cc.JsonAsset},jsonGroups:{default:null,type:cc.JsonAsset},jsonClubs:{default:null,type:cc.JsonAsset},stagenode:{default:null,type:cc.Node}},onLoad:function(){var t=this;this.stagenode.on(n.EventGameSuccess,this._onGameSuccess,this),this.stagenode.on(n.EventGameFail,this._onGameFail,this),this.stage=this.stagenode.getComponent("stage"),n.GameMgr.init({Countries:this.jsonCountries.json,Roles:this.jsonRoles.json,Groups:this.jsonGroups.json,Clubs:this.jsonClubs.json},function(){t.startgame()})},startgame:function(){this._cur=0,this.gotostage(this._cur)},gotostage:function(t){var e=r.StageList[t];e&&this.stage.enterstage(e)},_onGameSuccess:function(){this._cur++,this.gotostage(this._cur)},_onGameFail:function(){},test:function(){},askteam:function(t,e){var n="https://db.qiumibao.com/f/index/team?id="+t,r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&r.status>=200&&r.status<400&&a(r.responseText,e)},r.open("GET",n,!0),r.send()}}),cc._RF.pop()},{"../datas/stagelist":"stagelist","./utils":"utils"}],player:[function(t,e){"use strict";cc._RF.push(e,"0aacaaAWQ9Npp8cgI5ySuzY","player");var n=t("./utils");cc.Class({extends:cc.Component,name:"player",properties:{pid:0,label:{default:null,type:cc.Label},head:{default:null,type:cc.Sprite},mask:{default:null,type:cc.Node},icobk:{default:null,type:cc.Node}},start:function(){this.setv(this.pid)},setv:function(t){if(t){var e=n.GameMgr.getPlayer(t);e&&(this.label.string=e[n.Fields.zn],n.GameMgr.setPlayerSprite(this.head,e))}},disibled:function(t){var e=this.node.getComponent(cc.Button);this.mask.active=t,this.icobk.active=!t,e&&(e.interactable=!t)},onClick:function(){this.node.emit(n.EventClickCard,{pid:this.pid,nod:this.node})}}),cc._RF.pop()},{"./utils":"utils"}],slotbar:[function(t,e){"use strict";cc._RF.push(e,"9cc331B8dJJU58N9ulmon1k","slotbar");var n=t("./utils");cc.Class({extends:cc.Component,name:"slotbar",properties:{prefab:{default:null,type:cc.Prefab},panel:{default:null,type:cc.Node}},start:function(){},settings:function(t,e){this.panel.removeAllChildren(!0),this._ids=[],this._rules=e,this._waitOpt=!1,this._total=t,this._startx=-t*n.SlotBpeWidth/2+n.SlotBpeWidth/2,this.node.width=n.SlotBarWidth-(n.MaxSlots-t)*n.SlotBpeWidth},isfull:function(){return this._ids.length>=this._total},addSlot:function(t){var e=n.GameMgr.getPlayer(t);if(!e)return!1;if(this._ids.length>=this._total)return!1;var r=cc.instantiate(this.prefab);return!!r&&(r.x=this._startx+this._ids.length*n.SlotBpeWidth,r._pid=t,r.parent=this.panel,this._setv(r,e),this._ids.push(t),this._JudgeEscape(),!0)},_setv:function(t,e){var r=t.getChildByName("icon").getComponent(cc.Sprite);t.getChildByName("label").getComponent(cc.Label).string=e[n.Fields.zn],n.GameMgr.setPlayerSprite(r,e)},_JudgeEscape:function(){var t=n.GameMgr.ruleGroup(this._ids,this._rules),e=this._hasThree(t);if(e){var r=[],s=e.ids;this._ids.forEach(function(t){s.indexOf(t)<0&&r.push(t)}),this._ids=r,this.doactions(s,[].concat(r))}},_hasThree:function(t){for(var e=0,n=t.length;e<n;++e){var r=t[e];if(r)for(var s=0,a=r.length;s<a;++s)if(3===r[s].ids.length)return r[s]}},doactions:function(t,e){for(var n=this,r=this.panel.children,s=[],a=[],i=0,o=r.length;i<o;++i){var c=r[i];t.indexOf(c._pid)>=0?s.push({nod:c,f:i}):e.indexOf(c._pid)>=0&&a.push({nod:c,f:i})}this.scheduleOnce(function(){n._disp(s),n._move(a)},.2)},_disp:function(t){for(var e=0,n=t.length;e<n;++e)t[e].nod.removeFromParent(),t[e].nod.destroy()},_move:function(t){for(var e=0,r=t.length;e<r;++e)t[e].nod.x=this._startx+e*n.SlotBpeWidth}}),cc._RF.pop()},{"./utils":"utils"}],stagelist:[function(t,e,n){"use strict";cc._RF.push(e,"ac028gf/jhCV7mOCPcDMDYP","stagelist"),n.__esModule=!0,n.StageList=void 0,n.StageList=[{rules:["country"],slots:7,map:"3_3",filter:{name:"takeCountry",param:{pairs:4,list:["GBR","FRA"]}}},{rules:[["country"]],slots:7,map:"3_3",filter:{name:"takeCountry",param:{pairs:8,list:["GBR","FRA","BRA","ESP","POR","NED"]}}},{rules:[["group"]],slots:7,map:"3_3",filter:{name:"takeCountry",param:{pairs:16,list:["GBR","FRA","GER","ESP","POR","BEL","NED","BRA","ARG"]}}}],cc._RF.pop()},{}],stage:[function(t,e){"use strict";cc._RF.push(e,"8fb64aOwg9H+6VQR0U8Vjjt","stage");var n=t("./utils");cc.Class({extends:cc.Component,name:"stage",properties:{prefab:{default:null,type:cc.Prefab},layers:{default:null,type:cc.Node},slotbar:{default:null,type:cc.Node},cupbar:{default:null,type:cc.Node}},onLoad:function(){},start:function(){},loadstage:function(t){var e=this;cc.resources.load("stages/"+t,function(t,n){t||e._loads(n.json)})},enterstage:function(t){this._stagedata=t,this.loadstage(t.map)},_getSlotBar:function(){return this.slotbar.getComponent("slotbar")},_getCupBar:function(){return this.cupbar.getComponent("cupbar")},_loads:function(t){this.layers.removeAllChildren(!0);var e=t.size,r=void 0===e?n.DefCardSize:e,s=t.pts,a=this._stagedata,i=a.slots,o=void 0===i?n.MaxSlots:i,c=a.rules;this.curSlots=o<n.MinSlots?n.MinSlots:o>n.MaxSlots?n.MaxSlots:o,this._getSlotBar().settings(this.curSlots,c),this._getCupBar().setRules(c),this._createCards(s,r),this._enableCards()},_createCards:function(t,e){for(var r=e/n.DefCardSize,s=Math.floor(e-4),a=Math.floor(s/2),i=this._calcCardsCount(t),o=i.ss,c=i.cardids,l=[].concat(c),u=l.length,h=o.length,d=0;d<h;++d){var p=Math.floor(Math.random()*u),f=l[p];u--,l[p]=l[u];var g=this._createCard(f);if(g){var v=o[d];g.x=v[0],g.y=v[1],g.scale=r,g.parent=this.layers,g._rccard=new cc.Rect(g.x-a,g.y-a,s,s)}}},_calcCardsCount:function(t){var e=n.GameMgr.genids(this._stagedata.filter),r=t.length;if(r>=e.length)return{ss:t.slice(r-e.length),cardids:e};for(var s=e.length-r,a=[].concat(t),i=0;i<s;++i){var o=i%r;a.push(t[o])}return{ss:a,cardids:e}},_genCards:function(t){for(var e=n.GameMgr.players.length-1,r=[],s=0;s<e;++s)r[s]=s+1;for(var a=[].concat(r),i=[],o=0;o<t;++o){r.length<1&&(r=[].concat(a));var c=Math.floor(Math.random()*r.length);i.push(r[c]),r[c]=r[r.length-1],r.length=r.length-1}return i},_createLayers:function(t,e){for(var r=this._genLayerCards(t),s=0,a=t.length-1;a>=0;--a){var i=t[a],o=i.ps,c=i.sz,l=void 0===c?e:c,u=new cc.Node(a);u.parent=this.layers;for(var h=l/n.DefCardSize,d=0,p=o.length;d<p;++d){var f=o[d],g=this._createCard(r[s++]);g&&(g.x=f[0],g.y=f[1],g.scale=h,g.parent=u)}}},_genLayerCards:function(t){for(var e=this._calcLayerCards(t),r=n.GameMgr.players.length-1,s=[],a=0;a<r;++a)s[a]=a+1;for(var i=[].concat(s),o=[],c=0;c<e;++c){s.length<1&&(s=[].concat(i));var l=Math.floor(Math.random()*s.length);o.push(s[l]),s[l]=s[s.length-1],s.length=s.length-1}return o},_calcLayerCards:function(t){for(var e=0,n=t.length-1;n>=0;--n)e+=t[n].ps.length;return e},_createCard:function(t){if(t){var e=cc.instantiate(this.prefab),r=e.getComponent("player");return r.pid=t,r.disibled(!1),e.on(n.EventClickCard,this._onClickCard,this),e}},_enableCards:function(){for(var t=this.layers.children,e=t.length,n=0;n<e;++n){for(var r=t[n],s=r._rccard,a=!1,i=n+1;i<e;++i)if(s.intersects(t[i]._rccard)){a=!0;break}r.getComponent("player").disibled(a)}},_onClickCard:function(t){var e=t.pid,r=t.nod,s=this._getSlotBar();s.addSlot(e)?(r.removeFromParent(),r.destroy(),this._enableCards(),this.layers.children.length<1&&this.node.emit(n.EventGameSuccess,{})):s.isfull()&&this.node.emit(n.EventGameFail,{})}}),cc._RF.pop()},{"./utils":"utils"}],utils:[function(t,e,n){"use strict";cc._RF.push(e,"25d8d/SUh5BlpEbALTjdqA4","utils"),n.__esModule=!0,n.GameMgr=n.Fields=n.EventGameSuccess=n.EventGameFail=n.EventClickCard=n.DefCardSize=n.SlotBpeWidth=n.SlotBarWidth=n.MaxSlots=n.MinSlots=void 0,n.MinSlots=5,n.MaxSlots=7,n.SlotBarWidth=742,n.SlotBpeWidth=104,n.DefCardSize=128,n.EventClickCard="ClickCard",n.EventGameFail="GameFail",n.EventGameSuccess="GameSuccess";var r={id:0,zn:1,country:2,role:3,year:4,club:5,en:6,cn:7,league:8,group:9};n.Fields=r;var s={group:{title:"\u76f8\u540c\u5c0f\u7ec4"},country:{title:"\u76f8\u540c\u56fd\u5bb6"}},a={inited:!1,players:[],countryInGroup:{},Countries:null,Roles:null,Groups:null,Clubs:null,init:function(t,e){var n=this;this.inited||(this.inited=!0,this.Countries=t.Countries,this.Roles=t.Roles,this.Groups=t.Groups,this.Clubs=t.Clubs,this._genCountryInGroup(),cc.resources.load("players",function(t,r){t||(n._parsePlayers(r.text),e&&e())}))},_parsePlayers:function(t){for(var e=t.split("\n"),n=0,s=e.length;n<s;++n){var a=e[n].split(",");if(!a[2])break;a[r.group]=this.getCountryGroup(a[r.country]),this.players[n]=a}},_genCountryInGroup:function(){var t=this;Object.keys(this.Groups).forEach(function(e){t.Groups[e].forEach(function(n){t.countryInGroup[n]=e})})},getCountryGroup:function(t){return this.countryInGroup[t]},getPlayer:function(t){return this.players[t]},getRule:function(t){return s[t]},setPlayerSprite:function(t,e){cc.resources.load("icons/"+e[r.country]+"/"+e[r.id],cc.SpriteFrame,function(e,n){e||(t.spriteFrame=n)})},genids:function(t){var e=t.name,n=t.param,r=l[e];if(r)return r(n)},ruleGroup:function(t,e){var n=[];return e.forEach(function(e,r){var s=i[e];s&&(n[r]=s(t))}),n}};n.GameMgr=a;var i={country:function(t){return o(t,r.country)},group:function(t){return o(t,r.group)}};function o(t,e){var n=a.players,r={};t.forEach(function(t){var s=n[t][e];r[s]=r[s]||[],r[s].push(t)});var s=[];return Object.keys(r).forEach(function(t){var e={ids:r[t],key:t};s.push(e)}),s}function c(t,e){for(var n=[].concat(t),r=e-t.length,s=[].concat(t),a=0;a<r;++a){s.length<1&&(s=[].concat(t));var i=Math.floor(Math.random()*s.length);n.push(s[i]),s[i]=s[s.length-1],s.length=s.length-1}return n}var l={takeCountry:function(t){for(var e=a.players,n=t.pairs,r=c(t.list,n),s=[],i=0;i<n;++i){var o=p(e,{country:{func:"country",param:r[i]}},s);o&&cc.js.array.appendObjectsAt(s,o,s.length)}return s}},u={country:function(t,e){return t[r.country]===e},group:function(t,e){return t[r.group]===e}};function h(t,e){for(var n,r,s=Object.keys(e),a=s.length,i=0;i<a;++i){var o=s[i];if("object"==typeof e[o]){if(r=void 0,(r="function"==typeof(n=e[o]).func?n.func:u[n.func])&&!r(t,n.param))return!1}else if(e[o]!==d[o])return!1}return!0}function p(t,e,n){for(var r=[],s=1,a=t.length;s<a;++s)n.indexOf(s)<0&&h(t[s],e)&&r.push(s);if(r&&!(r.length<3)){for(var i=r.length,o=[],c=0;c<3;++c){var l=Math.floor(Math.random()*i);o.push(r[l]),i--,r[l]=r[i]}return o}}cc._RF.pop()},{}]},{},["stagelist","colorbk","cupbar","main","player","slotbar","stage","utils"]);